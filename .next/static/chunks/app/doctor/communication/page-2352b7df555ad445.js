(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[891],{7621:function(e,s,t){Promise.resolve().then(t.bind(t,1061))},1061:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return y}});var r=t(7437),a=t(2265),n=t(9376),i=t(7648),l=t(970),c=t(9178),d=t(4226),o=t(2660),u=t(3247),x=t(3417),m=t(2369),h=t(3041),f=t(9374),j=t(9345),p=t(4743),g=t(4284),b=t(1344),v=t(8349),N=t(2690);function y(){let e=(0,n.useRouter)(),[s,t]=(0,a.useState)(null),[y,w]=(0,a.useState)([]),[Z,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(""),[P,I]=(0,a.useState)(!0),[M,R]=(0,a.useState)(null),[z,E]=(0,a.useState)("");async function O(){try{let s=(0,l.e)(),{data:{user:r},error:a}=await s.auth.getUser();if(a||!r){e.push("/start-case");return}let{data:n,error:i}=await s.from("profiles").select("*").eq("id",r.id).single();if(i){e.push("/start-case");return}t(n);let{data:c,error:d}=await s.from("cases").select("\n          *,\n          patient:patients(\n            profile:profiles(full_name, email)\n          )\n        ").eq("doctor_id",r.id);if(d)console.error("Error fetching cases:",d);else{let e=new Map;null==c||c.forEach(s=>{var t;if(null===(t=s.patient)||void 0===t?void 0:t.profile){let t=s.patient.id;e.has(t)||e.set(t,{id:t,name:s.patient.profile.full_name,email:s.patient.profile.email,lastMessage:"No messages yet",lastMessageTime:new Date().toISOString(),unreadCount:0,status:"active"})}}),w(Array.from(e.values()))}}catch(e){console.error("Error fetching doctor data:",e),R("Failed to load patient data")}finally{I(!1)}}(0,a.useEffect)(()=>{O()},[]);let q=async()=>{if(C.trim()&&Z)try{console.log("Sending message to",Z.name,":",C),w(e=>e.map(e=>e.id===Z.id?{...e,lastMessage:C,lastMessageTime:new Date().toISOString()}:e)),S("")}catch(e){console.error("Error sending message:",e)}},L=y.filter(e=>e.name.toLowerCase().includes(z.toLowerCase())||e.email.toLowerCase().includes(z.toLowerCase()));return P?(0,r.jsx)(N.Z,{requiredRole:"doctor",children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(g.Z,{}),(0,r.jsx)(b.Z,{}),(0,r.jsx)("div",{className:"pt-32 pb-16",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg text-gray-600",children:"Loading patient communications..."})]})})})]})}):(0,r.jsx)(N.Z,{requiredRole:"doctor",children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(g.Z,{}),(0,r.jsx)(b.Z,{}),(0,r.jsx)("div",{className:"pt-32 pb-16",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-6",children:[M&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-400 text-red-700 rounded",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Error:"})," ",M]})}),(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(i.default,{href:"/doctor/dashboard",children:(0,r.jsx)(d.Z,{variant:"ghost",icon:o.Z,children:"Back to Dashboard"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Patient Communication"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Chat and communicate with your patients"})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Doctor"}),(0,r.jsxs)("div",{className:"font-semibold text-slate-900",children:["Dr. ",null==s?void 0:s.full_name]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:null==s?void 0:s.specialty})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Patients"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:L.length})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)("input",{type:"text",placeholder:"Search patients...",value:z,onChange:e=>E(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})]}),(0,r.jsx)(c.eW,{className:"p-0",children:0===L.length?(0,r.jsxs)("div",{className:"p-6 text-center",children:[(0,r.jsx)(x.Z,{className:"w-8 h-8 text-gray-300 mx-auto mb-3"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"No patients found"})]}):(0,r.jsx)("div",{className:"space-y-1",children:L.map(e=>(0,r.jsx)("div",{onClick:()=>k(e),className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-100 ".concat((null==Z?void 0:Z.id)===e.id?"bg-blue-50 border-blue-200":""),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(m.Z,{className:"w-5 h-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-slate-900 text-sm",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500 truncate max-w-32",children:e.lastMessage})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.lastMessageTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.unreadCount>0&&(0,r.jsx)("div",{className:"w-5 h-5 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center mt-1",children:e.unreadCount})]})]})},e.id))})})]})}),(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)(c.Zb,{className:"h-96",children:Z?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Ol,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(m.Z,{className:"w-5 h-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-slate-900",children:Z.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:Z.email})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d.Z,{variant:"ghost",size:"sm",icon:h.Z,children:"Call"}),(0,r.jsx)(d.Z,{variant:"ghost",size:"sm",icon:f.Z,children:"Video"}),(0,r.jsx)(d.Z,{variant:"ghost",size:"sm",icon:j.Z,children:"Email"})]})]})}),(0,r.jsxs)(c.eW,{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50 rounded-lg mb-4",children:(0,r.jsxs)("div",{className:"text-center text-gray-500 text-sm",children:[(0,r.jsx)(x.Z,{className:"w-8 h-8 mx-auto mb-2"}),(0,r.jsxs)("p",{children:["Start a conversation with ",Z.name]})]})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:C,onChange:e=>S(e.target.value),onKeyPress:e=>"Enter"===e.key&&q(),placeholder:"Type your message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,r.jsx)(d.Z,{onClick:q,disabled:!C.trim(),icon:p.Z,children:"Send"})]})]})]}):(0,r.jsx)(c.eW,{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(x.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Select a Patient"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Choose a patient from the list to start messaging"})]})})})})]})]})}),(0,r.jsx)(v.default,{})]})})}},2690:function(e,s,t){"use strict";t.d(s,{Z:function(){return d}});var r=t(7437),a=t(2265),n=t(9376),i=t(970),l=t(4284),c=t(1344);function d(e){let{children:s,requiredRole:t,fallbackUrl:d="/start-case"}=e,o=(0,n.useRouter)(),[u,x]=(0,a.useState)(!0),[m,h]=(0,a.useState)(null),[f,j]=(0,a.useState)(!1);async function p(){try{let e=(0,i.e)(),{data:{user:s},error:r}=await e.auth.getUser();if(r||!s){h("Please sign in to access this portal."),j(!0);return}let{data:a,error:n}=await e.from("profiles").select("*").eq("id",s.id).single();if(n){h("Please complete your profile to access this portal."),j(!0);return}if(t&&a.role!==t){h("Access denied. This portal is for ".concat(t,"s only.")),j(!0);return}j(!0)}catch(e){console.error("Authentication error:",e),h("Authentication failed. Please sign in again."),j(!0)}finally{x(!1)}}return((0,a.useEffect)(()=>{p()},[o,t,d]),u||!f)?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(l.Z,{}),(0,r.jsx)(c.Z,{}),(0,r.jsx)("div",{className:"pt-32 pb-16",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg text-gray-600",children:"Checking authentication..."})]})})})]}):m?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(l.Z,{}),(0,r.jsx)(c.Z,{}),(0,r.jsx)("div",{className:"pt-32 pb-16",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)("svg",{className:"w-12 h-12 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"patient"===t?"Patient Portal Access":"doctor"===t?"Doctor Portal Access":"Portal Access"}),(0,r.jsx)("p",{className:"text-lg text-gray-600 mb-8",children:m}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("button",{onClick:()=>o.push("/start-case"),className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),"Sign In / Register"]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:()=>o.push("/"),className:"text-blue-600 hover:text-blue-800 font-medium",children:"← Back to Homepage"})})]})]})})})]}):(0,r.jsx)(r.Fragment,{children:s})}},4226:function(e,s,t){"use strict";var r=t(7437),a=t(2265),n=t(4508);let i=a.forwardRef((e,s)=>{let{variant:t="primary",size:a="md",icon:i,iconPosition:l="left",loading:c=!1,className:d,children:o,disabled:u,...x}=e,m=(0,n.cn)("btn inline-flex items-center justify-center gap-2 font-medium transition-all duration-200 focus-visible:outline-2 focus-visible:outline-ring focus-visible:outline-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"btn-primary",secondary:"btn-secondary",ghost:"btn-ghost",outline:"btn-outline",link:"btn-link"}[t],{sm:"px-3 py-2 text-sm",md:"px-4 py-2.5 text-base",lg:"px-6 py-3 text-lg"}[a],d);return(0,r.jsxs)("button",{ref:s,className:m,disabled:u||c,...x,children:[c&&(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent"}),i&&"left"===l&&!c&&(0,r.jsx)(i,{className:"h-4 w-4"}),o,i&&"right"===l&&!c&&(0,r.jsx)(i,{className:"h-4 w-4"})]})});i.displayName="Button",s.Z=i},9178:function(e,s,t){"use strict";t.d(s,{Ol:function(){return l},Zb:function(){return i},eW:function(){return c}});var r=t(7437),a=t(2265),n=t(4508);let i=a.forwardRef((e,s)=>{let{variant:t="default",padding:a="md",className:i,children:l,...c}=e,d=(0,n.cn)("card",{default:"bg-surface border-border",elevated:"bg-surface border-transparent shadow-lg",outlined:"bg-transparent border-border"}[t],{none:"",sm:"p-4",md:"p-6",lg:"p-8"}[a],i);return(0,r.jsx)("div",{ref:s,className:d,...c,children:l})}),l=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("card-header",t),...i,children:a})}),c=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("card-body",t),...i,children:a})}),d=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("card-footer",t),...i,children:a})});i.displayName="Card",l.displayName="CardHeader",c.displayName="CardBody",d.displayName="CardFooter"},970:function(e,s,t){"use strict";t.d(s,{e:function(){return a}});var r=t(6188);let a=()=>(0,r.createBrowserClient)("https://eqjpdytmsohfpohecczz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxanBkeXRtc29oZnBvaGVjY3p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MzM1NzcsImV4cCI6MjA3NDQwOTU3N30.DDNR98O9E1rcWirNZPOuoSYjaUDSuReNcZQbZtxTjgQ")},4508:function(e,s,t){"use strict";t.d(s,{cn:function(){return n}});var r=t(1994),a=t(3335);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.m6)((0,r.W)(s))}},2660:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3417:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},3247:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},4743:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},2369:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9374:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]])},9376:function(e,s,t){"use strict";var r=t(5475);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[972,862,137,188,349,422,971,117,744],function(){return e(e.s=7621)}),_N_E=e.O()}]);